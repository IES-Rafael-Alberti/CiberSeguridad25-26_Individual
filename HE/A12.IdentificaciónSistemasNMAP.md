<h1 align="center">A12. Identificación de sistemas con NMAP</h1>

---

## Índice

1. ***[Introducción](#1-introducción)***
2. ***[Objetivo](#2-objetivo)***
3. ***[Alcance](#3-alcance)***
4. ***[Metodología](#4-metodología)***
5. ***[Resultados](#5-resultados)***
6. ***[Conclusión](#6-conclusión)***

---
## 1. ***Introducción***

En esta práctica se ha utilizado la herramienta **Nmap** para realizar un reconocimiento activo sobre un sistema objetivo, simulando una auditoría de tipo **caja negra**. 

El objetivo principal es obtener información sobre el sistema, como los servicios que tiene abiertos, el sistema operativo y posibles fallos de configuración que puedan suponer un riesgo de seguridad. Al tratarse de una máquina específicamente diseñada para ser vulnerable (**Metasploitable**), los resultados arrojan una gran superficie de ataque.

---
## 2. ***Objetivo***

El objetivo de esta práctica es recopilar información del sistema objetivo mediante el uso de **Nmap** y sus scripts (NSE), con el fin de conocer cómo está expuesto en la red. 

A partir de este análisis se pretende identificar el sistema operativo, los puertos abiertos, los servicios activos y posibles vulnerabilidades críticas que puedan ser aprovechadas como vectores de ataque.

---
## 3. ***Alcance***

El análisis se ha realizado sobre una máquina de laboratorio **Metasploitable**, desplegada en un entorno local (VirtualBox) y destinada únicamente a prácticas de seguridad. 

No se ha atacado ningún sistema real ni se ha realizado explotación activa de los fallos encontrados, limitándose el trabajo a tareas de reconocimiento y reporte de vulnerabilidades mediante Nmap.

---
## 4. ***Metodología***

Para la realización de esta práctica se ha seguido una metodología de reconocimiento estructurada:

1. **Descubrimiento de Host:** Confirmación de la IP y estado del objetivo.
2. **Escaneo de Puertos:** Análisis completo de los 65.535 puertos TCP y los puertos UDP más comunes.
3. **Fingerprinting:** Identificación del Sistema Operativo y versiones exactas de los servicios.
4. **Auditoría con Scripts (NSE):** Uso de scripts especializados para buscar vulnerabilidades (`vuln`), métodos de autenticación (`auth`) y enumeración web (`http-enum`).
5. **Documentación:** Recopilación de evidencias y análisis de resultados.

---
## 5. ***Resultados***

A continuación se detallan los hallazgos obtenidos durante la fase de reconocimiento.

### 5.1. ***Dirección IP del objetivo***

Tras verificar la configuración de red en el entorno de laboratorio, se identificó la dirección IP del sistema objetivo:

#### **192.168.56.103**

---
### 5.2. ***Sistema operativo***

Para identificar el sistema operativo se ha utilizado el flag `-O` junto con detección de versiones para mayor precisión:

```bash
sudo nmap -O -sS -v 192.168.56.103

```

<img width="846" height="796" alt="image" src="https://github.com/user-attachments/assets/ec6a2549-38e8-47fd-87e7-8029054ff74d" />


Nmap detectó con éxito que el sistema se ejecuta bajo un kernel:

* **SO:** Linux 2.6.9 - 2.6.33.
* **CPE:** `cpe:/o:linux:linux_kernel:2.6`
* **Network Distance:** 1 hop (Directo).

---

### 5.3. ***Puertos y servicios abiertos***

Se realizó un escaneo exhaustivo de todo el rango de puertos TCP (1-65535):

```bash
sudo nmap -p- -sS 192.168.56.103

```


El sistema presenta una superficie de exposición extremadamente alta. Los puertos principales detectados son:

| Puerto | Protocolo | Servicio |
| --- | --- | --- |
| 21 | TCP | FTP |
| 22 | TCP | SSH |
| 23 | TCP | Telnet |
| 25 | TCP | SMTP |
| 80 | TCP | HTTP |
| 445 | TCP | SMB (microsoft-ds) |
| 3306 | TCP | MySQL |
| 5432 | TCP | PostgreSQL |
| 6667 | TCP | IRC |
| 8180 | TCP | HTTP-Proxy (Tomcat) |

También se analizó la capa UDP:

```bash
sudo nmap -sU --top-ports 20 192.168.56.103

```

> **ESPACIO PARA TU CAPTURA 3 (Puertos UDP)**

Puertos UDP destacados: **53 (DNS)** y **137 (NetBIOS-NS)**.

---

### 5.4. ***Versiones de servicios***

Para conocer las aplicaciones exactas y su grado de actualización, se ejecutó:

```bash
sudo nmap -sV -p 21,22,23,25,53,80,139,445,3306,5432,6667,8180 192.168.56.103

```

<img width="1008" height="448" alt="image" src="https://github.com/user-attachments/assets/f2723096-a7d0-43a6-ad16-37731e224fb4" />


| Puerto | Servicio | Versión Detectada |
| --- | --- | --- |
| 21 | FTP | vsftpd 2.3.4 |
| 22 | SSH | OpenSSH 4.7p1 Debian |
| 80 | HTTP | Apache httpd 2.2.8 (Ubuntu) |
| 139/445 | SMB | Samba smbd 3.X - 4.X |
| 6667 | IRC | UnrealIRCd |
| 8180 | HTTP | Apache Tomcat/Coyote 1.1 |

---

### 5.5. ***Comprobación de credenciales y autenticación***

Utilizando el script `--script auth`, se analizaron las políticas de acceso:

```bash
sudo nmap --script auth -p 21,22,139,445,3306 192.168.56.103

```

<img width="966" height="806" alt="image" src="https://github.com/user-attachments/assets/03ba82de-632b-4f55-9d04-c33ad95a4ca7" />


Hallazgos de seguridad:

* **FTP:** Se permite el acceso con el usuario **anonymous**.
* **SMB:** El sistema permite la enumeración de sesiones y el acceso como invitado (**guest**).
* **SSH:** Soporta autenticación por contraseña, lo que permite ataques de diccionario.

---

### 5.6. ***Vulnerabilidades detectadas***

Este es el punto más crítico del análisis. Se utilizó el motor de scripts de Nmap para detectar CVEs conocidos:

```bash
sudo nmap --script vuln -p 21,80,445,6667 192.168.56.103

```

<img width="966" height="806" alt="image" src="https://github.com/user-attachments/assets/3387fe4d-b1c8-4b33-a7d1-f2ba1f213c01" />


| Vulnerabilidad | Servicio | Riesgo | Descripción |
| --- | --- | --- | --- |
| **CVE-2011-2523** | vsftpd 2.3.4 | **CRÍTICO** | Backdoor que permite acceso directo como **Root**. |
| **CVE-2007-6750** | Apache | **Medio** | Vulnerabilidad Slowloris (Denegación de Servicio). |
| **SQL Injection** | HTTP (Mutillidae) | **Alto** | Múltiples parámetros vulnerables a inyección de base de datos. |
| **Backdoor IRC** | UnrealIRCd | **CRÍTICO** | Ejecución remota de comandos mediante troyano en el servicio. |

---

### 5.7. ***Servicios web detectados***

El escaneo `http-enum` reveló la estructura de los servidores web en los puertos 80 y 8180:

> **ESPACIO PARA TU CAPTURA 7 (http-enum)**

Se detectaron aplicaciones de entrenamiento y paneles de gestión:

* `/dvwa/`: Damn Vulnerable Web Application.
* `/mutillidae/`: Plataforma para pruebas de SQLi y XSS.
* `/phpMyAdmin/`: Panel de gestión de bases de datos.
* `/twiki/`: Aplicación Wiki con posibles fallos de CSRF.

---

### 5.8. ***Ejecución de scripts por defecto***

Finalmente, se ejecutó `-sC` para obtener información miscelánea del sistema:

```bash
sudo nmap -sC -p 21,22,80,139,445,3306 192.168.56.103

```

<img width="1363" height="775" alt="image" src="https://github.com/user-attachments/assets/b7683d53-d1e2-489b-964f-8415a12a8612" />


Resultados adicionales:

* **SMB Discovery:** El sistema se identifica como `METASPLOITABLE` en el grupo de trabajo `WORKGROUP`.
* **Seguridad SMB:** La firma de mensajes está deshabilitada (`disabled`), facilitando ataques de tipo *Man-in-the-Middle* (Relay).

---

## 6. ***Conclusión***

La auditoría realizada con Nmap sobre la máquina 192.168.56.103 ha revelado un sistema **altamente vulnerable**. La presencia de puertas traseras (backdoors) en servicios estándar como FTP e IRC representa un riesgo absoluto, permitiendo a un atacante tomar el control total del servidor en pocos segundos.

Este ejercicio demuestra la potencia de Nmap no solo como un escáner de puertos, sino como una herramienta completa de auditoría capaz de identificar fallos críticos de seguridad sin necesidad de herramientas adicionales. Se recomienda la actualización inmediata de los servicios o, en un entorno real, la desconexión total del host de la red.

